---
title: "Зелимхан Гудиев. Лабораторная №1"
output: html_document
date: "2022-10-28"
editor_options: 
  markdown: 
    wrap: sentence
---

Для выполнения дальнейших заданий предположим, что таблица исходных данных в R была названа myData.
Можно использовать любое другое удобное имя (например, "iris"), корректируя вводимые команды соответственно.
Вставьте данные в рабочее пространство R через буфер обмена либо другим способом.
По умолчанию отсутствующие значения маркируются как "NA".
Необходимо также указать десятичный разделитель в исходных данных для конвертирования его в формат разделителя R, и задать метки разделителя колонок в буфере обмена (для Windows "\t\"), а также вставить заголовки.
Если данные вставляются из буфера обмена:

```{r}
# функция показывает текущую рабочую директорию
path_dir <- getwd()

myData <- read.table(file=paste0(path_dir, "/iris_example.csv"), dec =",", sep = ",", header=TRUE)
myData <- edit(myData)
head(myData)
```

Проверьте, есть ли наблюдения, в которых значения по какому-либо параметру отсутствуют, и выведите список этих значений.

```{r}
sum(is.na(myData))
myData[!complete.cases(myData),]
```

**Ответ:**\ 
*в данных содежится 22 пропуска (NA). Выше приведен вывод всех строк, в которых имеется хотя бы одно пропущенное значение.*\

Примите решение, что, на ваш взгляд, целесообразно в данном случае сделать с пропущенными значениями.
В частности, подставьте вместо отсутствующих значений среднее с помощью функции na.aggregate

```{r, warning=FALSE}
library(zoo)
# поскольку колонки являются количественными показателями, 
myData[] <- lapply(myData, na.aggregate)
sum(is.na(myData))
```

**Ответ:**\ 
*пропуски заменены на среднее арифметичекие, расчитанные для каждой переменной*\

Кратко ответьте на следующие вопросы.
1) Что является элементарной единицей в этом наборе данных?\
**Ответ:**\
*Цветок/Строка.*

2)  Определите вид данных: одномерные, двумерные, многомерные?

```{r}
dim(myData) 
```

**Ответ:**\
*Двумерные если исходить из того, что данные представлены в виде дата фрейма (строки и столбцы). Если исходить из тоого, что в данных имеются 5 различных характеристик (измерений) для каждого объекта (цветка), то можно сказать, что данные многомерные.*\

3) Определите какие из этих переменных количественные, а какие качественные?

```{r}
str(myData)
library(dplyr)
colnames(select_if(myData, is.numeric))
colnames(select_if(myData, is.character))
```

**Ответ:**\
*количественные переменные: SEPALLEN, SEPALWID, PETALLEN, PETALWID; качественные переменные: IRISTYPE.*\


4)  Какие из этих переменных номинальные?
    Какие порядковые?\
    **Ответ:**\
    *Порядковые переменные в данных отсутствуют; номинальные переменные: IRISTYPE.*\

5)  Это временной ряд или данные об одном временном срезе?\
    **Ответ:**\
    *Данные об одном временном срезе.*\

6)  Укажите, какие операции можно применять к каждой из переменных?\
    **Ответ:**\
    *К числовым переменным можно применять агреггационные операции (расчет разнообразных статистик), к качественным переменным можно применять группировку. Также ко всем данными можно применять фильтрацию**\

7)  Сформулируйте (в общих терминах), на какие вопросы можно найти ответы при детальном анализе набора данных такого типа.\
    **Ответ:**\ 
    *ответы на вопросы о мерах центральной тенденции и мерах изменчивости.*\

Проверьте количество наблюдений и переменных.

```{r}
dim(myData)
```

**Ответ:***150 наблюедений и 5 переменных.*\

Проверьте структуру данных.
В частности, количественные переменные должны иметь атрибут «числовая», качественные -- «factor», а также являются ли данные таблицей или фреймом.

```{r}
str(myData)
```

```{r}
attributes(myData)
```

**Ответ:**\
*Данные имеют 3 количественные и 1 качественную переменную. При этом качественная переменная имеет тип "character". Данные имеют структуру дата фрейма*\

Рассчитайте описательные статистики.

```{r}
summary(myData)
```

Рассчитайте винзорированную (триммированную) среднюю по каждой переменной и сопоставьте это значение с исходным средним и медианным значением.
Сделайте выводы.

```{r}
# библиотека с функцией Винзор
library(psych)
# выделяем каждую численную колонку в отдельную переменную и считаем для нее винзорированное среднее
x1 <- myData[, "SEPALLEN"]
winsor.mean(x1, trim = 0.2, na.rm = TRUE)

x2 <- myData[, "SEPALWID"]
winsor.mean(x2, trim = 0.2, na.rm = TRUE)

x3 <- myData[, "PETALLEN"]
winsor.mean(x3, trim = 0.2, na.rm = TRUE)

x4 <- myData[, "PETALWID"]
winsor.mean(x4, trim = 0.2, na.rm = TRUE)
```

**Ответ:**\
*Поскольку винзорированные средние меньше обычных средних, значит в нашей выборке могут присутствовать выбросы со стороны больших значений.*\

Проверьте данные на наличие выбросов по каждой переменной, присвоив ей буквенное значение (x1, х2, х3...).

```{r}
boxplot.stats(x1)$out
boxplot(x1)

boxplot.stats(x2)$out
boxplot(x2)

boxplot.stats(x3)$out
boxplot(x3)

boxplot.stats(x4)$out
boxplot(x4)

```

**Ответ:**\ 
*Выбросы имеются только в переменной SEPALWID*\

Значения, которые являются выбросами для всех переменных:

```{r}
df <- data.frame(x1, x2, x3, x4)
# rm(x1, x2, x3, x4)
attach(df) # attach позволяет обращаться к переменным x1,x2,x3,x4 дата фрейма df без необходимости указвать наименования дата фрейма x1
(a <- which(x1 %in% boxplot.stats(x1)$out))
(b <- which(x2 %in% boxplot.stats(x2)$out))
(c <- which(x3 %in% boxplot.stats(x3)$out))
(d <- which(x3 %in% boxplot.stats(x4)$out))
detach(df)
```

```{r}
(outlier.list1 <- Reduce(intersect, list(a, b, c, d)))
```

**Ответ:**\ 
*В данных отсутствуют значения, которые являются выбросами для всех переменных*\

Значения, которые являются выбросом для хотя бы одной переменной:

```{r}
(outlier.list2 <- Reduce(union, list(a, b, c, d)))
```

**Ответ:**\ 
*Вышеуказанные строки являются выбросами хотя бы для одной переменной*\

Выделите выбросы с помощью кластерного анализа.
Напомним, что в кластерном анализе методом К-средних данные группируются на основе близкого расположения к плотным скоплениям.
Выбросами, поэтому, будут считаться наблюдения, находящиеся в относительном удалении от таких скоплений.
Для выделения выбросов необходимо убрать, при ее наличии, качественную переменную, записав данные под новым именем:

```{r}
myData2 <- myData[,1:4]
```

Проведите кластеризацию методом К-средних, выделив три кластера:

```{r}
kmeans.result <- kmeans(myData2, centers = 3)
```

Отобразите центры кластеров:

```{r}
kmeans.result$centers
```

Рассчитайте расстояния от объектов до центров кластеров:

```{r}
centers <- kmeans.result$centers[kmeans.result$cluster, ]
distances <- sqrt(rowSums((myData2 - centers)^2))
```

Возьмите несколько (например, 5) наибольших получившихся расстояний.

```{r}
outliers <- order(distances, decreasing=T)[1:5]
print(outliers)
print(myData2[outliers,])
```

Проверьте с помощью графика, можно ли считать эти наблюдения выбросами:

```{r}
plot(myData2[, c("SEPALLEN", "SEPALWID")], pch = "o", col = kmeans.result$cluster, cex = 1.2)
points(kmeans.result$centers[, c("SEPALLEN", "SEPALWID")], col = 1:3, pch = 8, cex = 1.5, lwd = 4)
points(myData2[outliers, c("SEPALLEN", "SEPALWID")], pch = "+", col = 4, cex = 1.7)

plot(myData2[, c("PETALLEN", "PETALWID")], pch = "o", col = kmeans.result$cluster, cex = 1.2)
points(kmeans.result$centers[, c("PETALLEN", "PETALWID")], col = 1:3, pch = 8, cex = 1.5, lwd = 4)
points(myData2[outliers, c("PETALLEN", "PETALWID")], pch = "+", col = 4, cex = 1.7)
```

**Ответ:**\
*Да, данные наблюедения можно счиать выбросами*\

Кратко опишите, какие наблюдения являются аномальными: - только по одной переменной;  
**Ответ:**\
*Выбросами по одной переменной являются строки: 71, 79, 87, 97*\

-   сразу по всем переменным. 
**Ответ:**
*Выборсами по всем переменным являются строки: 24, 89, 144, 45, 120*\

Выдвиньте разумные предположения о том, чем могли быть вызваны эти аномальные значения.
Сделайте выводы о том, что, в данном случае, целесообразно предпринять относительно выбросов.
**Ответ: выбросы это цветы с экстремальными значениями PETALWID и PETALLEN. Поскольку для наше    задачи они не оказывают существенного влияния и их количество не велико, оптимальным решением будет оставить выбросы в выборке.**\

Представьте данные в виде: (где y, x1, x2, ... -- количественные переменные из данных) блочных диаграмм:

```{r}
boxplot(x1)
boxplot(x2)
boxplot(x3)
boxplot(x4)
```

гистограмм:

```{r}
hist(x1)
hist(x2)
hist(x3)
hist(x4)
```

попарной матрицы диаграмм рассеяния:

```{r}
 pairs(~ x1 + x2 + x3 + x4)
```

тепловой диаграммы:

```{r}
distMatrix <- as.matrix(dist(myData[, 1:4]))
heatmap(distMatrix)
```

уровневой диаграммы

```{r}
library(lattice)
myData[, 5] <- as.factor(myData[, 5])
levelplot(IRISTYPE ~ SEPALLEN * SEPALWID, myData, cuts = 9, col.regions = grey.colors(10)[10:1])

levelplot(IRISTYPE ~ PETALLEN * PETALWID, myData, cuts = 9, col.regions = grey.colors(10)[10:1])

levelplot(SEPALLEN ~ PETALLEN * PETALWID, myData, cuts = 9, col.regions = grey.colors(10)[10:1])
```

контурной диаграммы (диаграммы высот) (также в библиотеке lattice)

```{r}
filled.contour(as.matrix(myData[, 1:3]), color=terrain.colors, asp=1
               #, plot.axes=contour(as.factor(myData[, 1:4]), add=T)
               )
filled.contour(as.matrix(myData[, c(1, 2, 4)]), color=terrain.colors, asp=1
               #, plot.axes=contour(as.factor(myData[, 1:4]), add=T)
               )
filled.contour(as.matrix(myData[, c(3, 4, 1)]), color=terrain.colors, asp=1
               #, plot.axes=contour(as.factor(myData[, 1:4]), add=T)
               )
filled.contour(as.matrix(myData[, c(3, 4, 5)]), color=terrain.colors, asp=1
               # , plot.axes=contour(as.matrix(myData[, 3]), as.matrix(myData[, 4]), z = as.matrix(myData[, 5]), add=T)
               )
```
**Ответ:**\
*Непонятно что использовать в квчестве контура для нашего датасета, поэтому приведем код лабораторно в этом пункте без изменений.*
```{r}
filled.contour(volcano, color=terrain.colors, asp=1, plot.axes=contour(volcano, add=T))
```


поверхности многомерного распределения

**Ответ:**\
*Поскольку непонятно как представить наши данные как матрицу перепадов высот, и чем должно быть третье измерение, оставим корд без изменений.*\
```{r}
persp(volcano, theta=25, phi=30, expand=0.5, col="lightblue")
```

графика параллельных координат на основе переменных #1 - 4 (по порядку слева направо из данных) в качестве числовых, и переменной #5 (IRISTYPE) в качестве группировочной (библиотека MASS).

```{r}
library(MASS)
parcoord(myData[1:4], col = as.factor(myData[, 5]))
```

Сделайте выводы.\
Напишите аналитическую записку о том, что представляют собой имеющиеся данные, какова их структура и описательные характеристики, какие результаты получены на основе первичного анализа и обработки.\
**Выводы:**\ 
*Датасет представляет из себя таблицу с 4 количественными колонками и одной категориальной, количество наблюдений в таблице - 150. В процессе исследования датасета были обнаружены пустые значения (в 21 строке были обнаружены NA), которые было решено заполнить среднеми значениями, т.к. пустые значения находились в количественных колонках и по смыслу средний показатель по колонке частично компненсирует упущенную информацию. Также были обнаружены экстремальные значения в колонке SEPALWID, 3 значения которые выходят за 1.5*IQR от Q3 и одно значение, выходящее за 1.5*IQR от Q1. Были подсчитаны винзорированные(триммированные) средние, которые не сильно отличались от средних со всеми элементами, что говорит о незначительном влиянии выбросов и крайних значений на статистики в нашем датасете. Также выбросы, в которых участвую сразу несколько признаков, были исследованы с помощью метода К-средних, были обнаружены 5 значений наиболее удаленных от центров получившихся кластеров.Также в процессе кластеризации и визуализации данных было выявлено, что классы наиболее разделимы по признакам PETALLEN и PETALWID.*

