---
title: "Зелимхан Гудиев. Лабораторная №5"
output:
  pdf_document: default
  html_document: default
date: "2022-11-04"
---

# Лабораторная работа 3 по дисциплине "Data Mining"
Ассоциативное моделирование

Используются данные о пассажирах «Титаника».
Введите данные в рабочее пространство. (в этом случае Данные «Титаник» содержатся в базовом наборе примеров R, и это делать необязательно)
Выведите общие сведения о данных. Укажите, какие имеются параметры, какого они вида, и какие возможные значения принимают. Сделайте несколько (4-5) предположений о том, какие закономерности можно найти в этих данных. Для каждого предположения сформулируйте, как должен быть поставлен исследовательский (аналитический) вопрос о его выяснении. 
```{r}
str(Titanic)
```
**Ответ:**\
*В данном наборе данных можно исследовать как влияли пол, возраст и пассажирский класс на выживаемость пассажиров. Влияет ли пол на выживаемость? Влияет ли класс каюты на выживаемость? Влияет ли возраст на выживаемость? Влияет ли пересечение этих признаков на выживаемость, т.е. отличается ли вероятность выжить у мужчин из 1-го и второго класса? А вероятность выжить у взрослых и детей мужского пола разная?*\

3. Переведите данные в формат фрейма.
```{r}
df<- as.data.frame(Titanic)
```

4. Создайте чистую таблицу данных "titanic.raw", создав заголовки из исходных данных, и затем переместив исходные данные в эту таблицу. Проверьте, сколько наблюдений и параметров содержит этот файл (dim())? 
Рассматриваются ли категориальные переменные действительно как категориальные? 
Обратите внимание, что в новых данных категориальным переменным  также присвоены числовые кодировки для возможных значений.
Сделайте общие выводы о наблюдениях в данных (summary).
```{r}
titanic.raw <- NULL
for(i in 1:4) {titanic.raw <- cbind(titanic.raw, rep(as.character(df[,i]), df$Freq))}
titanic.raw <- as.data.frame(titanic.raw)
names(titanic.raw) <- names(df)[1:4]
dim(titanic.raw)
summary(titanic.raw)
```

Присвоить имена колонкам можно командой (в данном случае колонки уже озаглавлены, и команда повторяет эти названия)
```{r}
names(titanic.raw)<-c("Class", "Sex", "Age", "Survived")
```

5. Выполните поиск ассоциативных закономерностей. Сколько всего закономерностей вы получили? Приведите полученные закономерности в виде списка или таблицы. Приведите несколько ассоциативных правил (5-7), представляющих исследовательский интерес. Приведите несколько ассоциативных правил (3-4), которые не имеют содержательного смысла.

```{r}
library(arules)
rules.all<-apriori(titanic.raw)
rules.all 
inspect(rules.all)
```
**Ответ:**\
*Получено 27 закономерностей. Правила представляющие инетерес (связаны с выживаемостью):*\
[6]	{Survived=Yes}	=>	{Age=Adult}
[9]	{Survived=No}	=>	{Sex=Male}	
[10]	{Survived=No}	=>	{Age=Adult}
[13]	{Class=3rd, Sex=Male}	=>	{Survived=No}
[17]	{Class=Crew, Survived=No}	=>	{Sex=Male}
[18]	{Class=Crew, Survived=No}	=>	{Age=Adult}
[21]	{Sex=Male, Survived=No}	=>	{Age=Adult}
[22]	{Age=Adult, Survived=No}	=>	{Sex=Male}
[25]	{Class=3rd, Sex=Male, Age=Adult}	=>	{Survived=No}

*Бессмысленные для нас правила (нет информации о выживаемости):*\
[2]	{Class=2nd}	=>	{Age=Adult}		
[7]	{Class=Crew}	=>	{Sex=Male}
[4]	{Sex=Female}	=>	{Age=Adult}
[8]	{Class=Crew}	=>	{Age=Adult}

6. Выполните ассоциативный анализ для поиска закономерностей, характеризующих только выживаемость, и отсортируйте их по убыванию критерия интересности (lift). Сколько было получено правил? Приведите полученные правила в виде списка или таблицы.
```{r}
rules <- apriori(titanic.raw, control = list(verbose = F),
                 parameter = list(minlen = 2, supp = 0.005, conf = 0.8),
                 appearance = list(rhs = c("Survived = No", "Survived = Yes"),
                                   default = "lhs")) 
quality(rules) <- round(quality(rules), digits = 3) 
rules.sorted <- sort(rules, by = "lift") 
inspect(rules.sorted)
```
**Ответ:**\
*12 правил получено.*\

7. Из полученных правил ассоциации найдите три пары закономерностей, из которых одна является превосходящей по отношению к другой, и, как следствие, излишней, проведя математическую проверку для выявления таких правил (является ли одно множество подмножеством другого). Опишите эти правила, указав, что конкретно является не предоставляет дополнительной информации для каждого излишнего правила. 
(Определение. Излишним признается правило, которое является более общим по отношению к другому, и имеет такой же либо более низкий критерий подъема (lift). Например, правило 2 излишне по отношению к правилу 1, поскольку, согласно правилу 1, все дети из второго класса выжили. Этот пример в отчете о лабораторной использовать уже нельзя ☺ )
```{r}
subset.matrix <- is.subset(rules.sorted, rules.sorted)
# subset.matrix[lower.tri(subset.matrix, diag = T)] <- NA
redundant <- colSums(subset.matrix, na.rm = T) > 1
which(!redundant)
```
**Ответ:**\
*Правило 4 является излишним по отношению к правилу 3, т.к. вероятность выжить женщин из 1-го класса не зависит от возраста. Правило 7 является излишним по отношению к правилу 6, т.к. вероятность выжить женщин из команды не зависит от возраста.*\
8. удалите излишние правила на основе этой проверки. Приведите, в виде списка или таблицы, оставшиеся правила.
```{r}
rules.pruned <- rules.sorted[!redundant]
inspect(rules.pruned)
```

9. Интерпретируйте оставшиеся правила на основе их содержательного значения либо здравого смысла, с учетом достоверности. 
(Например, правило 1 имеет уровень достоверности 1.0 и подъем 3.0, и интерпретируется как «все дети из класса 2 выжили». В то же время, правил по детям из 1 и 3 классов нет. Как следствие, можно неверно интерпретировать правило 1 как то, что дети 2 класса имели больший шанс на выживание, однако, правило всего лишь утверждает, что все дети 2 класса выжили, но не содержит информации о детях других классов, поэтому необходимо получить подобную информацию отдельно – см. задание 10.)
**Ответ:**\
**Правило 2 имеет уровень достоверности 0.97 и подъем 3: женщины из первого класса выживают в 97% случаев и вероятность выжить для женщины из первого класса выше в 3 раза, чем для пассажира первого класса в общем.**\

10. Проведите ассоциативный анализ выживших по 1-3 классам на основе возрастов «ребенок» и «взрослый», исключая прочую информацию:
```{r}
rules <- apriori(titanic.raw,
                 parameter = list(minlen = 3, supp = 0.002, conf = 0.2),
                 appearance = list(rhs = c("Survived = No", "Survived = Yes"),
                                 lhs = c("Class = 1st", "Class = 2nd", "Class = 3rd", "Age = Child", "Age = Adult"),
                                 default = "none"),
                 control=list(verbose = F))
inspect(rules)
```
Ответьте на вопросы:\
А) отличается ли выживаемость детей из 1 класса от ехавших 2-м? \
**Ответ:** *- Нет.*\
Б) какой процент детей, ехавших первым классом, выжили?\
**Ответ:** *- 100%*\
В) какой процент детей, ехавших третьим классом, выжили?\
**Ответ:** *- 34.17%*\
Г) какой процент взрослых, ехавших вторым классом, выжили? Сопоставьте это значение с числом в вопросе (В)\
**Ответ:** *- 36.01%, почти на два процента больше чем выжило детей из 3-го класса*\
Д) какой процент взрослых, ехавших первым классом, выжили? Сопоставьте это значение с числами в вопросах (В) и (Г)\
**Ответ:** *- 61.75%, почти в два раза больше чем детей из 3-го класса и взрослых из 2-го.*\

11. Представьте данные в виде графика ассоциаций. Приведите 2-3 примера ассоциативных правил из графика. Можно ли утверждать обратное для этих правил? Для каких можно, и для каких – нельзя? Обоснуйте ваш ответ. 
```{r, include = FALSE,echo = FALSE}
library(arulesViz)
```
```{r}
plot(rules.all, method = "graph")
```
или
```{r}
plot(rules.all, method = "graph", control = list(type = "itemsets"))
```
(для выполнения лабораторной приведите оба графика)\
**Ответ:** *3 правила из графика: Мужчина-Не выжил, Не выжил-Взрослый, Команда-Взрослый. Для правил с низким support можно утверждать обратное, т.к. статистика невелика.*\
12. Напишите аналитическую записку (0,5-1 стр.) о том, какие результаты получены в результате ассоциативного анализа.\
**Ответ:**\
*По результатам исследования, можно заключить, что наибольшим влиянием на выживаемость пассажира оказывал признак принадлежности к классу кают, потом возраст и последним был пол. Наибольшая вероятность выжить была у детей из 1 и 2 классов, вне зависимости от пола. Из врослых пассажиров выжили как правило женщины во всех классах. Наименьшая вероятность выжить была у взрослых мужчин из низших классов кают.*